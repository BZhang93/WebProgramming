<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="../stylesheets/stylesheet.css" media="screen" />
<link rel="stylesheet" type="text/css" href="../stylesheets/pygment_trac.css" media="screen" />
<link rel="stylesheet" type="text/css" href="../stylesheets/print.css" media="print" />
<link rel="stylesheet" type="text/css" href="../stylesheets/custom.css" media="screen" />

<!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<title>COMP 20: Web Programming - Web Security</title>
</head>
    
<body>
<header>
<div class="inner">
<h1>Web Programming</h1>
<a href="https://github.com/tuftsdev/WebProgramming" class="button"><small>All examples used in class<br/>are here on </small>GitHub</a>
<h2>Web Security</h2>
</div>
</header>

<div id="content-wrapper">
<div class="inner clearfix">
<section id="main-content">
<h3>Overview</h3>
<ul>
<li><a href="https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project" target="_blank">OWASP Top 10</a></li>
<li>Why are web applications now the juiciest targets? <span class="stress">Business data</span></li>
<li>Despite social engineering is the reason for most data breaches, crackers, and malicious code are still significant</li>
<li>Poor programming practices and poorly trained developers abound</li>
<li>Software security and making software behave is very hard</li>
<li>Legal issues are hampering security research (e.g., copyrights, DMCA)</li>
<li>The problems are only getting worse</li>
</ul>

<h3>Step 1: Reconnaissance</h3>
<ul>
<li>Information gathering</li>
<li>Find any information leakage</li>
<li>Create a map of the web application</li>
<li>"Poke around"</li>
<li>The areas of interest:
<ul>
<li>Comments in HTML source code</li>
<li>Sensitive information in HTML source code</li>
<li>HTML form names and actions --especially hidden form fields</li>
<li>Parameters passed to pages</li>
<li>Server-side error messages and HTTP responses</li>
<li>Application error messages</li>
<li>URLs</li>
</ul>
</li>
<li>If you get your hands on the source code
<ul>
<li>Application comments</li>
<li>SQL queries</li>
<li>Database connection strings</li>
</ul>
</li>
<li>Strategies
<ul>
<li>Google is your friend</li>
<li>Look for patterns</li>
<li>Make educated guesses.  Examples: <code>admin</code>, <code>cp</code>, <code>js</code>, <code>images</code></li>
</ul>
</li>
<li>Prevention and protection
<ul>
<li>Do not rely on security through obscurity</li>
<li>On Apache web servers, utilize and modify <code>.htaccess</code> and <code>.htpasswd</code> files</li>
</ul>
</li>
</ul>

<h3>The Cardinal Sin: Input Validation (or lack thereof)</h3>
<ul>
<li>Entering strings (alphabets) instead of numbers</li>
<li>Invalid date format (ugh!)</li>
<li>Entering more characters than the length of the field (will also sometimes cause the dreaded buffer overflow)</li>
<li>What will the following call do: <code>open (FOO, "| mail ihateyou@sucker.com; rm -rf *")</code></li>
<li>All user input is initially <span class="stress">tainted</span></li>
<li>Basic rule of untainting: <span class="stress">express what you want</span> rather than what you don't want. The former leaves no chance for error; the latter leaves the intrepid hacker a possible opening. Take e-mail addresses for example, if you write:
<pre>
	if ($email =~ /^([^;]*)$/) {
		my $untainted_email = $1;
		open (FOO, &quot;| mail $untainted_email&quot;) ...
	}
</pre>
</li>
<li>In the above example: Joe Hacker can't write <code>ihateyou@sucker.com ; rm -rf *</code>  but <span class="stress">can write</span>: <code>ihateyou@sucker.com &amp;&amp; rm -rf *</code> with the same effect!</li>
<li>The correct regular expression:
<pre>
	if ($email =~ /^([a-zA-Z][-+a-zA-Z0-9._]*@[-+a-zA-Z0-9._]*)$/) {
	}
</pre>
</li>
<li>Regular expressions also helps immensely!</li>
</ul>

<h3>Our Attack Playground</h3>
<ul>
<li>Try me: <a href="http://www.cs.tufts.edu/comp/20/examples/hackme.php">http://www.cs.tufts.edu/comp/20/examples/hackme.php</a></li>
</ul>

<h3>Assessing Web Applications for Vulnerabilities</h3>
<ul>
<li>Automatically using a scanner and proxy
<ul>
<li><a href="http://www.portswigger.net/suite/" target="_blank">Burp Suite</a></li>
<li><a href="http://www.owasp.org/index.php/Category:OWASP_WebScarab_Project" target="_blank">OWASP WebScarab</a></li>
<li><a href="http://www.parosproxy.org/" target="_blank">Paros</a></li>
</ul>
</li>
<li>Many app scanners also come with a spidering tool</li>
<li>Captures the URLs that you enter in web browser, and subsequent URLs and pages</li>
<li>Scans an entire web application or website for pages, SQL injection vulnerabilities, XSS vulnerabilities, hidden fields, cookies, etc.</li>
<li>You can change cookies, form fields, and hidden fields on-the-fly and see the results
<ul>
<li><a href="https://addons.mozilla.org/en-US/firefox/addon/966/" target="_blank">Tamper Data</a> - a Firefox plugin</li>
</ul>
</li>
</ul>

<h3>Attack: Directory Traversal, File Guessing, and Messing with URL Parameters</h3>
<ul>
<li>Conducting the attack: take a look at the URL on your web browser; tinker with it</li>
<li>In this example: a course website, <code>http://www.cs.tufts.edu/comp/116/lectures/[01-15].php</code></li>
<li>Another example, <code>http://target/..%5C..%5C..%5C..%5C..%5C..%5C/etc/passwd</code> where '%5C' is the URL version of the '/' character</li>
<li>Prevention and protection:
<ol>
<li>Access control lists (ACLs)</li>
<li>Restrict the web application to serve pages only from a web root directory and its subdirectories</li>
</ol>
</li>
</ul>

<h3>Attack: Bypassing Restrictions on Input Choices</h3>
<ul>
<li>Examples: <code>&lt;input type="text" name="first_name" <strong>maxlength="30"</strong> /&gt;</code>, <code>&lt;input type="radio" name="option" <strong>value="Ice Cream"</strong> /&gt;</code></li>
<li>Can be applied on practically all input forms</li>
<li>Conducting the attack:
<ol>
<li>Save a page to your desktop, modify it, resending it</li>
<li>Use a proxy program to modify values in-transit</li>
</ol>
</li>
<li>Prevention and protection: server-side input validation</li>
</ul>

<h3>Attack: Hidden Fields</h3>
<ul>
<li>All hidden fields are sent to server on submits (POST or GET)</li>
<li>Very easy to identify: <code>&lt;input type="hidden" name="...</code></li>
<li>State-based attack</li>
<li>Rookie mistake: using hidden field to store sensitive information so it can be passed from one page to another.  Examples: account number, password, product price</li>
<li>Back-in-the-days: <a href="http://www.edgeblog.net/2006/how-to-buy-a-plasma-for-99/" target="_blank">buy a plasma screen TV for $0.99</a>
<ul>
<li><a href="http://www.securityfocus.com/bid/1237/discuss" target="_blank">More details on SecurityFocus</a></li>
<li>Many software packages and vendors have plugged this hole</li>
</ul>
</li>
<li>Conducting the attack: see above; ask yourself whether the information is valuable enough</li>
<li>Prevention and protection: avoid using hidden fields</li>
</ul>

<h3>Attack: Cross Site Scripting (XSS)</h3>
<ul>
<li>Potential consequences:
<ul>
<li>Present <span class="stress">all users</span> with fraudulent web content</li>
<li>Steal cookie information</li>
<li>Malicious code injection</li>
<li>Annoying messages</li>
</ul>
</li>
<li>Not the same as phishing</li>
<li>Conducting the attack: where users input data that is echoed to other users.  Example: message board</li>
<li>How do you embed a script into an HTML page? <code>&lt;script&gt;</code></li>
<li>XSS cheat sheet: <a href="http://ha.ckers.org/xss.html" target="_blank">http://ha.ckers.org/xss.html</a></li>
<li>Prevention and protection: remove the ability for data to be interpreted as code.  Pay attention to the angle brackets.  Change:
<ul>
<li>Change &lt; to &amp;lt;</li>
<li>Change &gt; to &amp;gt;</li>
</ul>
</li>
<li>XSS Payload Samples:
<ul>
<li><code>&lt;script&gt;alert('XSS');&lt;/script&gt;</code></li>
<li><code>&lt;script&gt;window.document.getElementById("<span class="stress">SOME_ID</span>").innerHTML='&lt;img src="<span class="stress">SOME_IMAGE_URL</span>" /&gt;';&lt;/script&gt;</code>
<ul>
<li>Example: <code>&lt;script&gt;window.document.getElementById("searchedWords").innerHTML='&lt;img src="http://imagemacros.files.wordpress.com/2009/06/its_a_trap.jpg" /&gt;';&lt;/script&gt;</code></li>
</ul>
</li>
</ul>
</li>
</ul>

<h3>Attack: SQL Injection</h3>
<ul>
<li>The idea: insert SQL queries and commands into input data</li>
<li>The consequences:
<ul>
<li>Access data that you should not have access to</li>
</ul>
</li>
<li>What is the difference between:
<ul>
<li><code>SELECT * FROM personnel WHERE login = 'mchow'</code></li>
<li><code>SELECT * FROM personnel WHERE login = 'mchow' OR 1=1</code></li>
</ul>
</li>
<li>A comment in SQL is designated by <code>--</code></li>
<li>A big culprit is the single-quote (')</li>
<li>Conducting the attack: can only be used in a web application with a database</li>
<li>What is wrong with this?: <code>$query = "SELECT * FROM users WHERE user_id = '" . $_POST['user_id'] . "' AND password = '" . $_POST['passwd'] .  "'";</code></li>
<li>Prevention and protection:
<ol>
<li>Filter out special characters</li>
<li>Limit the data and privileges that the database user has access to (e.g., via MySQL Administrator).  That is, only give users the rights that they really need.  This is a security principle known as <span class="stress">least privilege</span>.</li>
<li>Bind your variables using the <code>?</code> placeholder in a SQL query.  One way this can be accomplished in PHP - MySQL is to use <a href="http://php.net/manual/en/book.pdo.php" target="_blank">PDO</a> or <a href="http://php.net/manual/en/book.mysqli.php" target="_blank">Mysqli</a></li>
</ol>
</li>
</ul>

</section>
</div>
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-582953-9");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
</html>
